<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>test bind template</title>
    <script src="../../jquery/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="../../underscore/underscore-1.6.0.js" type="text/javascript"></script>
    <script src="../../library/pluginmanager/pluginmanager.js" type="text/javascript"></script>
    <script src="bindtemplate_set.js" type="text/javascript"></script>
    <script src="bindtemplate_get.js" type="text/javascript"></script>
</head>
<body>
    <div id="container" data-test0="[0]" data-value0="0">
        <div>
            <div>
                <input type="text" data-test1="[2].D[0]" />
                <input type="text" data-test1="[2].D[1]" />
            </div>
            <div>
                <input type="text" data-test1="[0].A" />
                <input type="text" data-test1="[0].B" />
                <input type="text" data-test1="[1].C" />
            </div>
        </div>
        <div>
            <div>
                <input type="text" data-test2="F[1]" />
                <input type="text" data-test2="G.H" />
            </div>
            <div>
                <input type="text" data-test2="E" />
                <input type="text" data-test2="F[0]" />
            </div>
        </div>
        <span data-test0="[0]"></span>
    </div>
    <div id="container1">
        <input type="text" data-test0="[0]" />
    </div>
    <input id="button1" type="button" value="getData" />
    <script>
        $(function () {
            var testJson0 = [
                    0
                ],
                testJson1 = [
                    {
                        A: 1,
                        B: 2
                    },
                    {
                        C: 3
                    },
                    {
                        D: [
                            4,
                            5
                        ]
                    }
                ],
                testJson2 = {
                    E: 6,
                    F: [
                        7,
                        8
                    ],
                    G: {
                        H: 9
                    }
                };

            $('#container,#container1')
                 .bindTemplate('setData', {
                     attr: 'data-test0',
                     data: testJson0,
                     set: setfieldValue
                 })
                .bindTemplate('setData', {
                    attr: 'data-test1',
                    data: testJson1,
                    set: setfieldValue
                })
                .bindTemplate('setData', {
                    attr: 'data-test2',
                    data: testJson2,
                    set: setfieldValue
                });

            $('#button1').click(function () {
                alert(JSON.stringify($('#container,#container1').bindTemplate('getData', {
                    attr: 'data-test0',
                    get: getfieldValue
                }), null, 10));

                alert(JSON.stringify($('#container,#container1').bindTemplate('getData', {
                    attr: 'data-test1',
                    get: getfieldValue
                }), null, 10));

                alert(JSON.stringify($('#container,#container1').bindTemplate('getData', {
                    attr: 'data-test2',
                    get: getfieldValue
                }), null, 10));

                alert(JSON.stringify($('#container,#container1').bindTemplate('getData', {
                    attr: 'data-test3',
                    get: getfieldValue
                }), null, 10));
            });

            function setfieldValue(value, selector, index) {
                var $field = this;

                console.log(selector, index, value);

                switch (true) {
                    case $field.is(':text'):
                    case $field.is('select'):
                        $field.val(value);
                        break;

                    case $field.is('div'):
                        $field.attr('data-value0', value);
                        break;

                    default:
                        $field.html(value);
                        break;
                }
            }

            function getfieldValue(selector) {
                var $field = this;

                console.log(selector);

                switch (true) {
                    case $field.is(':text'):
                    case $field.is('select'):
                        return $field.val();

                    case $field.is('div'):
                        return $field.attr('data-value0');

                    default:
                        return $field.html();
                }
            }
        });
    </script>
</body>
</html>
